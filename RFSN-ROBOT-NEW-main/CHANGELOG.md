# RFSN-ROBOT Changelog\n\n## Version 12.1 - Production Ship Gate (2026-01-20)\n\n### Major Features\n\n**Ship Gate Validation System**\n- Enforces non-optional production safety checklist before any episode runs\n- Runtime validation of self-collision, safety manager, learner firewall, fault state\n- Deterministic seeding with full reproducibility bundles\n- Automated CI test that blocks shipping if checklist incomplete\n\n### New Components\n\n**Ship Gate Module (`rfsn/ship_gate.py`)**\n- `seed_everything(seed)`: Sets all random seeds for reproducibility\n- `validate_runtime_safety(facts, config)`: Asserts all safety requirements met\n- `assert_ship_ready(model, pipeline, config)`: Main validation entry point\n- `create_reproducibility_bundle(...)`: Creates audit-ready JSON bundle\n\n**CI Test (`tests/test_ship_gate.py`)**\n- Parses `RELEASE_CHECKLIST.md` and fails if any item unchecked\n- Verifies ship_gate module structure and configuration\n- Automated enforcement of production requirements\n\n### Enhanced Components\n\n**Pipeline Integration**\n- `create_pipeline()` now calls ship gate validation automatically\n- Stores reproducibility bundle in `pipeline._reproducibility_bundle`\n- Seed enforcement at pipeline creation\n\n**State Machine Documentation**\n- Clarified that timeouts are for failure detection only\n- Documented predicate-based transition logic\n- V12.1 upgrade notes in docstring\n\n**Release Checklist**\n- 6 of 8 items now checked and enforced\n- Remaining items require manual verification\n\n### Checklist Items Satisfied\n\n- ✓ Deterministic seed set\n- ✓ Self-collision enabled (runtime check)\n- ✓ Safety envelope enforced (runtime check)\n- ✓ Learner firewalled (runtime check)\n- ✓ Fault state reachable (runtime check)\n- ✓ Logs reproducible (bundle creation)\n\n### Files Modified\n\n- `rfsn/ship_gate.py` (NEW, 250 lines)\n- `rfsn/pipeline.py` (+10 lines)\n- `rfsn/harness.py` (+2 lines)\n- `rfsn/harness_v2.py` (+2 lines)\n- `rfsn/__init__.py` (+8 lines)\n- `rfsn/state_machine.py` (docstring update)\n- `tests/test_ship_gate.py` (NEW, 100 lines)\n- `RELEASE_CHECKLIST.md` (6 items checked)\n- `docs/V12.1_UPGRADE_SUMMARY.md` (NEW)\n\n### Breaking Changes\n\nNone. Backward-compatible hardening release.\n\n### Migration Guide\n\nV12 users: No changes required. Ship gate runs automatically.\n\nV11 users: Optionally add explicit `assert_ship_ready()` call.\n\nCI/CD: Add `pytest tests/test_ship_gate.py` to test suite.\n\n### Expected Impact\n\n- **Reproducibility**: All runs now have deterministic seeds and audit bundles\n- **Safety**: Runtime validation prevents unsafe configurations from running\n- **Shippability**: Automated checklist enforcement prevents incomplete releases\n\n### Performance\n\nNegligible overhead: ~1ms one-time validation at pipeline creation.\n\n### Documentation\n\n- See `docs/V12.1_UPGRADE_SUMMARY.md` for complete implementation details\n- All functions have docstrings with parameter descriptions\n- Checklist items mapped to code implementations\n\n---\n\n\n## Version 6.0 - Grasp Validation Hardening (2026-01-15)\n\n### Major Features\n\n**Enhanced Grasp Validation System**\n- Implements object-follows-EE attachment proxy using sliding window history\n- Adds real-time slip detection via velocity spikes and position drift\n- Requires bilateral contact persistence before allowing GRASP→LIFT transitions\n- Continuous monitoring during LIFT with automatic recovery on attachment loss\n\n### New Components\n\n**History Tracking (`GraspHistoryBuffer`)**\n- 20-step sliding window for object/EE relative state\n- Tracks positions, velocities, and contact patterns\n- Enables temporal reasoning about grasp quality\n\n**Attachment Proxy**\n- Detects when object follows EE motion\n- Computes confidence based on:\n  - Relative position stability (std < 1.5cm)\n  - Relative velocity magnitude (< 5cm/s)\n  - Height correlation (> 0.7)\n\n**Slip Detection**\n- Velocity spike detection (15cm/s threshold)\n- Position drift monitoring (2cm in 5 steps)\n- Contact intermittency tracking\n\n**Contact Persistence**\n- Bilateral finger contact validation\n- Requires 5 of last 10 steps with both fingers\n- Prevents premature lifting\n\n### Enhanced State Machine\n\n**GRASP → LIFT Transition (V6 Mode)**\n- Requires ALL conditions:\n  - Quality ≥ 0.7\n  - Bilateral contact\n  - Object attached\n  - No slip detected\n  - Contact persistent\n  - Minimum time satisfied\n\n**LIFT State Monitoring**\n- Continuous slip/attachment checks\n- Immediate RECOVER on failure\n\n**Backward Compatibility**\n- V5 tests pass unchanged\n- Graceful fallback when history insufficient\n- Auto-detects enhanced vs. basic quality dicts\n\n### Evaluation & Logging\n\n**New Metrics**\n- `grasp_attempts`: Count of grasp state entries\n- `grasp_confirmed`: Successful GRASP→LIFT transitions\n- `false_lift_count`: Lifts that fail within 20 steps\n- `grasp_confirmation_time_s`: Time to confirm grasp\n- `slip_events`: Slip and attachment loss events\n- `grasp_success_rate`: confirmed/attempts\n- `false_lift_rate`: false_lifts/confirmed\n\n**Enhanced CSV Output**\n- All metrics logged per episode\n- Compatible with existing analysis tools\n\n**Event Logging**\n- `slip_detected` events with context\n- `attachment_lost` events during LIFT\n\n### Files Modified\n\n- `rfsn/mujoco_utils.py`: +400 lines (validation infrastructure)\n- `rfsn/obs_packet.py`: Added object velocity fields\n- `rfsn/harness.py`: +100 lines (history buffer integration)\n- `rfsn/state_machine.py`: Enhanced transitions with fallback\n- `rfsn/logger.py`: Grasp metrics tracking\n- `eval/metrics.py`: Grasp validation metrics computation\n\n### New Files\n\n- `demo_v6_grasp_validation.py`: Interactive demonstration\n- `V6_GRASP_VALIDATION_SUMMARY.md`: Complete implementation guide\n\n### Testing\n\n- ✓ All v5 tests pass (backward compatibility verified)\n- ✓ Enhanced validation unit tests\n- ✓ Integration tests with history buffer\n- ✓ Demo script validates all new features\n\n### Expected Impact\n\n- **Reduced false lift rate**: Stricter validation prevents lifting without confirmed grasp\n- **Faster failure recovery**: Early slip detection during LIFT\n- **Improved success rate**: False lifts are major failure mode; validation addresses this\n- **Better diagnostics**: Rich metrics help tune and debug grasp behavior\n\n### Performance\n\n- Minimal overhead: ~0.1ms per step for full validation\n- No impact outside GRASP/LIFT states\n- O(window_size) computation with 20-step window\n\n### Breaking Changes\n\nNone. All changes are additive with backward compatibility.\n\n### Migration Guide\n\nNo migration needed. Enhanced validation activates automatically when:\n1. Using `mode="rfsn"` or `mode="rfsn_learning"`\n2. State machine is in GRASP or LIFT states\n3. History buffer has ≥5 observations\n\nTo verify v6 features are active, check log output for:\n```\n[RFSN] GRASP confirmed (enhanced): quality=0.85, attached=True, persistent=True\n```\n\nvs. v5 mode:\n```\n[RFSN] GRASP confirmed (v5 mode): quality=0.85\n```\n\n### Demonstration\n\nRun the demo to see v6 features in action:\n```bash\npython demo_v6_grasp_validation.py\n```\n\n### Documentation\n\n- See `V6_GRASP_VALIDATION_SUMMARY.md` for complete implementation details\n- All functions have docstrings with parameter descriptions\n- Examples provided in demo script\n\n---\n\n## Version 5.0 - Safety Hardening & Profile Learning (Previous)\n\nSee `V5_UPGRADE_SUMMARY.md` for details.\n\nKey features:\n- SafetyClamp with poison/rollback system\n- UCB-based profile learning\n- Fail-loud contact parsing\n- Comprehensive logging infrastructure\n\n---\n\n## Earlier Versions\n\nSee git history and previous documentation files.